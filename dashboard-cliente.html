<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodFlow - √Årea do Cliente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .logo h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .user-email {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .nav-tabs {
            background: white;
            border-bottom: 2px solid #e9ecef;
            padding: 0 20px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            border-bottom-color: #007bff;
            color: #007bff;
        }

        .nav-tab:hover {
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }

        /* Lojas */
        .lojas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .loja-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .loja-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .loja-nome {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #007bff;
        }

        .loja-categoria {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 10px;
        }

        .loja-descricao {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .loja-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .status-aberto {
            color: #28a745;
        }

        .status-fechado {
            color: #dc3545;
        }

        /* Produtos */
        .produtos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .produto-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .produto-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .produto-nome {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .produto-descricao {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .produto-preco {
            font-size: 1.2rem;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 10px;
        }

        .btn-adicionar {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-adicionar:hover {
            background: #0056b3;
        }

        /* Carrinho */
        .carrinho-items {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .carrinho-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .carrinho-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
        }

        .item-nome {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .item-preco {
            color: #28a745;
            font-weight: 600;
        }

        .item-quantidade {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-quantidade {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .carrinho-total {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .total-valor {
            font-size: 1.5rem;
            font-weight: 700;
            color: #28a745;
            margin: 10px 0;
        }

        .btn-finalizar {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-finalizar:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        /* Pedidos */
        .pedidos-lista {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .pedido-card {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .pedido-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .pedido-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .pedido-id {
            font-weight: 600;
            color: #007bff;
        }

        .pedido-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pendente { background: #fff3cd; color: #856404; }
        .status-preparando { background: #cce7ff; color: #004085; }
        .status-em-entrega { background: #d1ecf1; color: #0c5460; }
        .status-entregue { background: #d4edda; color: #155724; }

        .pedido-total {
            font-weight: 600;
            color: #28a745;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .btn-voltar {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .btn-voltar:hover {
            background: #545b62;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .user-info {
                text-align: center;
            }

            .nav-container {
                flex-wrap: wrap;
            }

            .nav-tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .lojas-grid,
            .produtos-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Cabe√ßalho -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <h1>üçî FoodFlow</h1>
                <div>√Årea do Cliente</div>
            </div>
            <div class="user-info">
                <div class="user-name" id="userName">Bruno Silva</div>
                <div class="user-email" id="userEmail">bruno@email.com</div>
            </div>
        </div>
    </div>

    <!-- Navega√ß√£o -->
    <div class="nav-tabs">
        <div class="nav-container">
            <div class="nav-tab active" onclick="abrirTab('lojas')">üè™ Lojas</div>
            <div class="nav-tab" onclick="abrirTab('carrinho')">üõí Carrinho</div>
            <div class="nav-tab" onclick="abrirTab('pedidos')">üì¶ Meus Pedidos</div>
            <div class="nav-tab" onclick="abrirTab('perfil')">üë§ Meu Perfil</div>
        </div>
    </div>

    <!-- Conte√∫do -->
    <div class="container">
        <!-- Aba: Lojas -->
        <div id="lojas" class="tab-content active">
            <h2 class="page-title">üçΩÔ∏è Lojas Dispon√≠veis</h2>
            <div class="lojas-grid" id="lojasGrid">
                <!-- Lojas carregadas via JavaScript -->
            </div>
        </div>

        <!-- Aba: Carrinho -->
        <div id="carrinho" class="tab-content">
            <h2 class="page-title">üõí Meu Carrinho</h2>
            <div class="carrinho-items" id="carrinhoItems">
                <div class="empty-state">
                    <div>üõí</div>
                    <h3>Carrinho vazio</h3>
                    <p>Adicione produtos das lojas para ver aqui</p>
                </div>
            </div>
            <div class="carrinho-total" id="carrinhoTotal" style="display: none;">
                <h3>Total do Pedido</h3>
                <div class="total-valor" id="totalValor">R$ 0,00</div>
                <button class="btn-finalizar" onclick="finalizarPedido()">Finalizar Pedido</button>
            </div>
        </div>

        <!-- Aba: Pedidos -->
        <div id="pedidos" class="tab-content">
            <h2 class="page-title">üì¶ Meus Pedidos</h2>
            <div class="pedidos-lista" id="pedidosLista">
                <div class="empty-state">
                    <div>üì¶</div>
                    <h3>Nenhum pedido ainda</h3>
                    <p>Seus pedidos aparecer√£o aqui</p>
                </div>
            </div>
        </div>

        <!-- Aba: Perfil -->
        <div id="perfil" class="tab-content">
            <h2 class="page-title">üë§ Meu Perfil</h2>
            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <div style="margin-bottom: 15px;">
                    <strong>Nome:</strong> <span id="perfilNome">Bruno Silva</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>E-mail:</strong> <span id="perfilEmail">bruno@email.com</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Telefone:</strong> <span id="perfilTelefone">(11) 99999-9999</span>
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Endere√ßo:</strong> <span id="perfilEndereco">Rua Exemplo, 123 - S√£o Paulo, SP</span>
                </div>
                <button class="btn-finalizar" style="background: #007bff;" onclick="editarPerfil()">Editar Perfil</button>
            </div>
        </div>

        <!-- Produtos da Loja (aparece quando clica em uma loja) -->
        <div id="produtosLoja" class="tab-content">
            <button class="btn-voltar" onclick="voltarParaLojas()">‚Üê Voltar para Lojas</button>
            <h2 class="page-title" id="nomeLoja">üçî Loja</h2>
            <div class="produtos-grid" id="produtosGrid">
                <!-- Produtos carregados via JavaScript -->
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Configura√ß√£o do Supabase
        const supabaseUrl = 'https://lsskaqudqvppfwfoxsih.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2thcXVkcXZwcGZ3Zm94c2loIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDIxMzEsImV4cCI6MjA3NDgxODEzMX0.-M8bTf68RVY_kVrVyZ_BEfROLOrykauRYJzS2OnH6Fo';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Estado da aplica√ß√£o
        let carrinho = [];
        let lojaAtual = null;

        // Fun√ß√µes de navega√ß√£o
        function abrirTab(tabName) {
            // Esconde todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostra a tab selecionada
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="abrirTab('${tabName}')"]`).classList.add('active');
        }

        function verProdutos(loja) {
            lojaAtual = loja;
            document.getElementById('nomeLoja').textContent = `üçî ${loja.nome}`;
            abrirTab('produtosLoja');
            carregarProdutos(loja.id);
        }

        function voltarParaLojas() {
            abrirTab('lojas');
        }

        // Carregar lojas
        async function carregarLojas() {
            try {
                const { data: lojas, error } = await supabase
                    .from('lojas')
                    .select('*')
                    .eq('aberta', true);

                if (error) throw error;

                const grid = document.getElementById('lojasGrid');
                grid.innerHTML = '';

                if (lojas.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><div>üè™</div><h3>Nenhuma loja dispon√≠vel</h3><p>Volte mais tarde</p></div>';
                    return;
                }

                lojas.forEach(loja => {
                    const card = document.createElement('div');
                    card.className = 'loja-card';
                    card.onclick = () => verProdutos(loja);
                    
                    card.innerHTML = `
                        <div class="loja-nome">${loja.nome}</div>
                        <div class="loja-categoria">${loja.categoria || 'Geral'}</div>
                        <div class="loja-descricao">${loja.descricao || 'Sem descri√ß√£o'}</div>
                        <div class="loja-status">
                            <span class="status-aberto">‚óè</span> Aberto agora
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });

            } catch (error) {
                console.error('Erro ao carregar lojas:', error);
            }
        }

        // Carregar produtos
        async function carregarProdutos(lojaId) {
            try {
                const { data: produtos, error } = await supabase
                    .from('produtos')
                    .select('*')
                    .eq('loja_id', lojaId)
                    .eq('disponivel', true);

                if (error) throw error;

                const grid = document.getElementById('produtosGrid');
                grid.innerHTML = '';

                if (!produtos || produtos.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><div>üçΩÔ∏è</div><h3>Nenhum produto dispon√≠vel</h3><p>Esta loja ainda n√£o cadastrou produtos</p></div>';
                    return;
                }

                produtos.forEach(produto => {
                    const card = document.createElement('div');
                    card.className = 'produto-card';
                    
                    card.innerHTML = `
                        <div class="produto-nome">${produto.nome}</div>
                        <div class="produto-descricao">${produto.descricao || 'Sem descri√ß√£o'}</div>
                        <div class="produto-preco">R$ ${produto.preco?.toFixed(2) || '0,00'}</div>
                        <button class="btn-adicionar" onclick="adicionarAoCarrinho(${JSON.stringify(produto).replace(/"/g, '&quot;')})">
                            Adicionar ao Carrinho
                        </button>
                    `;
                    
                    grid.appendChild(card);
                });

            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
            }
        }

        // Carrinho
        function adicionarAoCarrinho(produto) {
            const itemExistente = carrinho.find(item => item.id === produto.id);
            
            if (itemExistente) {
                itemExistente.quantidade++;
            } else {
                carrinho.push({
                    ...produto,
                    quantidade: 1
                });
            }
            
            atualizarCarrinho();
            abrirTab('carrinho');
        }

        function atualizarCarrinho() {
            const itemsDiv = document.getElementById('carrinhoItems');
            const totalDiv = document.getElementById('carrinhoTotal');
            
            if (carrinho.length === 0) {
                itemsDiv.innerHTML = `
                    <div class="empty-state">
                        <div>üõí</div>
                        <h3>Carrinho vazio</h3>
                        <p>Adicione produtos das lojas para ver aqui</p>
                    </div>
                `;
                totalDiv.style.display = 'none';
                return;
            }

            let html = '';
            let total = 0;

            carrinho.forEach((item, index) => {
                const subtotal = (item.preco || 0) * item.quantidade;
                total += subtotal;
                
                html += `
                    <div class="carrinho-item">
                        <div class="item-info">
                            <div class="item-nome">${item.nome}</div>
                            <div class="item-preco">R$ ${subtotal.toFixed(2)}</div>
                        </div>
                        <div class="item-quantidade">
                            <button class="btn-quantidade" onclick="alterarQuantidade(${index}, -1)">-</button>
                            <span>${item.quantidade}</span>
                            <button class="btn-quantidade" onclick="alterarQuantidade(${index}, 1)">+</button>
                        </div>
                    </div>
                `;
            });

            itemsDiv.innerHTML = html;
            document.getElementById('totalValor').textContent = `R$ ${total.toFixed(2)}`;
            totalDiv.style.display = 'block';
        }

        function alterarQuantidade(index, mudanca) {
            carrinho[index].quantidade += mudanca;
            
            if (carrinho[index].quantidade <= 0) {
                carrinho.splice(index, 1);
            }
            
            atualizarCarrinho();
        }

        async function finalizarPedido() {
            if (carrinho.length === 0) return;

            try {
                const total = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
                
                const { data: pedido, error } = await supabase
                    .from('pedidos')
                    .insert([{
                        cliente_id: 1, // Em uma app real, seria o ID do usu√°rio logado
                        loja_id: lojaAtual.id,
                        total: total,
                        endereco_entrega: 'Endere√ßo do cliente', // Em uma app real, viria do perfil
                        status: 'pendente'
                    }])
                    .select();

                if (error) throw error;

                // Limpar carrinho
                carrinho = [];
                atualizarCarrinho();
                
                alert('üéâ Pedido realizado com sucesso!');
                abrirTab('pedidos');
                
            } catch (error) {
                console.error('Erro ao finalizar pedido:', error);
                alert('‚ùå Erro ao finalizar pedido. Tente novamente.');
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarLojas();
            // Em uma app real, carregar√≠amos os dados do usu√°rio logado
        });
    </script>
</body>
  </html>
